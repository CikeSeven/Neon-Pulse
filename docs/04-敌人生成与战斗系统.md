# 敌人生成与战斗系统

## 目录

- [1. 敌人生成系统](#1-敌人生成系统)
- [2. 敌人类型](#2-敌人类型)
- [3. 战斗系统](#3-战斗系统)
- [4. 受伤机制](#4-受伤机制)
- [5. 怪物数据](#5-怪物数据)

---

## 1. 敌人生成系统

### 1.1 生成规则

| 参数 | 值 |
|------|-----|
| 生成位置 | 屏幕右侧外 (x = 1100) |
| 生成方向 | 向左移动 |
| 生成间隔 | 基础4秒，随难度递减 |
| 生成轨道 | 3条轨道随机选择 |

### 1.2 生成管理器职责

```
生成管理器功能：
  • 控制敌人生成时机
  • 根据难度选择敌人类型
  • 管理波次生成
  • 调整生成间隔
```

---

## 2. 敌人类型

### 2.1 被动型 (Basic Enemy)

```
┌─────────────────────────────────────────────────────────┐
│ 类型：基础敌人                                          │
│ 行为：直线向左移动，不会主动攻击                        │
│ 特点：血量低，速度慢，作为炮灰                          │
└─────────────────────────────────────────────────────────┘

基础属性：
  • 生命值：30
  • 移动速度：150
  • 撞击伤害：10
  • 经验值：10
  • 金币：3

视觉：三角形 / 矩形
颜色：青色
```

### 2.2 冲撞型 (Charger)

```
┌─────────────────────────────────────────────────────────┐
│ 类型：冲刺敌人                                          │
│ 行为：发现玩家后加速冲向玩家                            │
│ 触发条件：与玩家同一轨道且距离小于300像素               │
│ 特点：速度快，血量中等，伤害高                          │
│ 躲避方式：切换轨道                                      │
└─────────────────────────────────────────────────────────┘

基础属性：
  • 生命值：50
  • 正常速度：150
  • 冲刺速度：350
  • 撞击伤害：20
  • 经验值：20
  • 金币：8

AI逻辑流程：
  1. 正常向左移动
  2. 检测是否与玩家同轨道
  3. 检测距离 < 300像素
  4. 加速冲向玩家
  5. 碰撞后销毁
```

### 2.3 射击型 (Shooter)

```
┌─────────────────────────────────────────────────────────┐
│ 类型：远程敌人                                          │
│ 行为：锁定玩家位置，定期发射飞行物                      │
│ 攻击频率：每2-3秒发射一次                               │
│ 特点：血量低，射程有限                                  │
└─────────────────────────────────────────────────────────┘

基础属性：
  • 生命值：25
  • 移动速度：100
  • 射击间隔：2.5秒
  • 子弹速度：300
  • 经验值：15
  • 金币：6

攻击模式：
  1. 缓慢向左移动
  2. 每2.5秒锁定玩家方向
  3. 发射追踪子弹
  4. 子弹伤害：5
```

### 2.4 追踪型 (Tracker)

```
┌─────────────────────────────────────────────────────────┐
│ 类型：追踪敌人                                          │
│ 行为：跨越轨道追踪玩家                                  │
│ 特点：血量高，速度中等                                  │
│ 难度：高                                                │
└─────────────────────────────────────────────────────────┘

基础属性：
  • 生命值：80
  • 移动速度：180
  • 追踪速度：120
  • 撞击伤害：15
  • 经验值：40
  • 金币：15

AI逻辑：
  1. 检测玩家位置
  2. 斜向移动接近玩家
  3. 可跨越轨道
  4. 随机换道
```

### 2.5 精英怪 (Elite)

```
┌─────────────────────────────────────────────────────────┐
│ 类型：精英敌人                                          │
│ 特点：比普通怪更强大                                    │
│ 标记：金色光晕 + 特殊外观                               │
│ 掉落：必掉稀有道具                                      │
└─────────────────────────────────────────────────────────┘

属性倍率：
  • 生命值：×2
  • 伤害：×1.5
  • 速度：×1.2
  • 金币：×3
  • 经验：×2
```

### 2.6 BOSS类型

```
┌─────────────────────────────────────────────────────────┐
│ 类型：关卡BOSS                                          │
│ 出现时间：每小关结束时                                  │
│ 特点：高血量，多种攻击方式                              │
└─────────────────────────────────────────────────────────┘

基础BOSS：
  • 生命值：500
  • 伤害：50
  • 阶段1：直线冲撞
  • 阶段2：发射散弹
  • 掉落：大量金币、传说道具

进阶BOSS：
  • 生命值：1000
  • 伤害：80
  • 三阶段攻击模式
  • 特殊技能
```

---

## 3. 战斗系统

### 3.1 伤害计算

**武器伤害计算：**

```
最终伤害 = 基础伤害 × 暴击倍率 × (1 - 护甲减免)
暴击伤害 = 基础伤害 × 2.0
护甲减免 = 护甲值 / 100
```

**玩家受伤计算：**

```
最终伤害 = 基础伤害 × (1 - 护甲/100)
最低伤害：1点
```

### 3.2 攻击判定系统

**Hitbox (攻击判定)：**
- 挂载在武器子弹和怪物攻击物上
- 触发 hit 信号，包含伤害值
- 可配置穿透次数

**Hurtbox (受伤判定)：**
- 挂载在玩家和怪物上
- 触发 hurt 信号
- 可配置无敌帧

---

## 4. 受伤机制

### 4.1 玩家受伤逻辑

```
玩家扣血公式：玩家扣血 = 当前怪物生命值 × 0.5 + 基础伤害10

设计说明：
  • 撞击满血BOSS会受到大量伤害 (500×0.5 + 10 = 260)
  • 撞击残血怪物伤害较低
  • 鼓励玩家先削弱怪物再接触
```

### 4.2 受伤反馈

| 反馈类型 | 内容 |
|----------|------|
| 视觉 | 屏幕边缘红色闪烁，玩家角色受击闪烁 |
| 数字 | 伤害数字飘字 |
| 震动 | 屏幕轻微震动 |
| 音效 | 受伤音效 |

### 4.3 受伤处理流程

```
检测碰撞 → 闪避判定 → 护甲减免 → 扣除HP → 更新UI → 检查死亡
```

---

## 5. 怪物数据

### 5.1 怪物属性表

| 敌人 | HP | 速度 | 伤害 | 经验 | 金币 | 特殊 |
|------|-----|------|------|------|------|------|
| 被动型 | 30 | 150 | 10 | 10 | 3 | 无 |
| 冲撞型 | 50 | 150/350 | 20 | 20 | 8 | 冲刺 |
| 射击型 | 25 | 100 | 5 | 15 | 6 | 发射子弹 |
| 追踪型 | 80 | 180 | 15 | 40 | 15 | 追踪玩家 |
| 精英怪 | 60-160 | 180 | 15 | 50 | 24 | 强化属性 |
| BOSS | 500+ | 100 | 50 | 300 | 80 | 多阶段 |

### 5.2 难度系数影响

```
关卡1 (1.0x): HP30, 伤害10
关卡5 (1.5x): HP45, 伤害15
关卡10 (2.4x): HP72, 伤害24
关卡20 (6.7x): HP201, 伤害67
关卡50 (97x): HP2910, 伤害970

难度公式：难度系数 = 1.10 ^ (关卡 - 1)
```

---

*文档版本：1.0*
*最后更新：2026年2月1日*
